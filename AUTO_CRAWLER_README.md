# ๐ค ฺฉุฑุงูู ุฎูุฏฺฉุงุฑ ุฏูุงุฑ - ุฑุงูููุง ฺฉุงูู

## ๐ฏ **ูุฏู**
ุณุณุชู ฺฉุฑุงูู ุฎูุฏฺฉุงุฑ ฺฉู ูุฑ ุณุงุนุช ฺฉุจุงุฑ ุงุฌุฑุง ูโุดูุฏ ู ุขฺฏูโูุง ุฌุฏุฏ ุฑุง ุงุฒ ุฏูุงุฑ ุงุณุชุฎุฑุงุฌ ูโฺฉูุฏ.

## ๐ **ุดุฑูุน ุณุฑุน**

### **1. ุงุฌุฑุง ฺฉุฑุงูู ุฎูุฏฺฉุงุฑ**:
```bash
npm run auto-crawler
```

### **2. ุชุณุช ฺฉุจุงุฑู ฺฉุฑุงูู**:
```bash
npm run auto-crawler:test
```

### **3. ุงุฌุฑุง ุฏุณุช**:
```bash
node src/auto-crawler.js
```

## โ๏ธ **ุชูุธูุงุช**

### **ูุงู ฺฉุงููฺฏ**: `src/config/auto-crawler.js`

#### **๐ ุชูุธูุงุช ุฒูุงูโุจูุฏ**:
```javascript
intervals: {
    hourly: 60 * 60 * 1000,        // ูุฑ ุณุงุนุช
    every2Hours: 2 * 60 * 60 * 1000, // ูุฑ 2 ุณุงุนุช
    every4Hours: 4 * 60 * 60 * 1000, // ูุฑ 4 ุณุงุนุช
    every6Hours: 6 * 60 * 60 * 1000, // ูุฑ 6 ุณุงุนุช
    daily: 24 * 60 * 60 * 1000      // ุฑูุฒุงูู
}

currentInterval: 'hourly' // ุชูุธู ูุนู
```

#### **๐๏ธ ุดูุฑูุง ู ุงููุงุน ุขฺฏู**:
```javascript
targets: [
    { 
        city: 'tehran', 
        adType: 'buy-apartment', 
        displayName: 'ุชูุฑุงู - ุฎุฑุฏ ุขูพุงุฑุชูุงู', 
        enabled: true 
    },
    // ... ุณุงุฑ ุดูุฑูุง
]
```

#### **โก ุชูุธูุงุช ฺฉุฑุงูู**:
```javascript
crawling: {
    timeout: 120000,           // 2 ุฏููู ุชุงูโุงูุช ุจุฑุง ูุฑ ุดูุฑ
    scrollDelay: 1000,         // 1 ุซุงูู ุชุงุฎุฑ ุจู ุงุณฺฉุฑููโูุง
    waitBetweenCities: 5000,   // 5 ุซุงูู ุงูุชุธุงุฑ ุจู ุดูุฑูุง
    timeBasedStopping: {
        enabled: true,
        maxAge: '3 ุณุงุนุช ูพุด',   // ุชููู ุฏุฑ ุขฺฏูโูุง ูุฏูโุชุฑ ุงุฒ 3 ุณุงุนุช
        crawlOlderAds: false   // ฺฉุฑุงูู ูฺฉุฑุฏู ุขฺฏูโูุง ูุฏู
    }
}
```

## ๐ง **ูฺฺฏโูุง ฺฉูุฏ**

### **1. ฺฉุฑุงูู ุฎูุฏฺฉุงุฑ**:
- โ ุงุฌุฑุง ุฎูุฏฺฉุงุฑ ูุฑ ุณุงุนุช
- โ ุชููู ููุดููุฏ ุจุฑ ุงุณุงุณ ุฒูุงู ุขฺฏูโูุง
- โ ุจุฑุฑุณ ุขฺฏูโูุง ุชฺฉุฑุงุฑ
- โ ุฐุฎุฑู ููุฑ ุฏุฑ ุฏุชุงุจุณ

### **2. ูุฏุฑุช ุฎุทุง**:
- โ ุชูุงุด ูุฌุฏุฏ ุฏุฑ ุตูุฑุช ุดฺฉุณุช
- โ ฺฏุฒุงุฑุดโฺฏุฑ ฺฉุงูู
- โ ุชููู ุงูู ุฏุฑ ุตูุฑุช ุฎุทุง

### **3. ูุธุงุฑุช ู ฺฏุฒุงุฑุดโฺฏุฑ**:
- โ ุงูู ุจุนุฏ ุงุฒ ูุฑ ุดูุฑ
- โ ุงูู ุฎูุงุตู ููุง
- โ ุขูุงุฑ ฺฉุงูู ุฏุชุงุจุณ
- โ ูุงฺฏโฺฏุฑ ุฏูู

### **4. ุชูุธูุงุช ุงูุนุทุงูโูพุฐุฑ**:
- โ ุชุบุฑ ูุงุตูู ุฒูุงู
- โ ูุนุงู/ุบุฑูุนุงู ฺฉุฑุฏู ุดูุฑูุง
- โ ุชูุธู ูพุงุฑุงูุชุฑูุง ฺฉุฑุงูู
- โ ุดุฎุตโุณุงุฒ ุงููโูุง

## ๐ **ูุญูู ฺฉุงุฑฺฉุฑุฏ**

### **ูุฑุญูู 1: ุฑุงูโุงูุฏุงุฒ**
```
๐ค Starting Divar Auto-Crawler Service...
โฐ Will run every 60 minutes
๐ Started at: [ุชุงุฑุฎ ู ุฒูุงู]
```

### **ูุฑุญูู 2: ฺฉุฑุงูู ุงููู**
```
๐ Performing initial crawl...
๐ Processing: ุชูุฑุงู - ุฎุฑุฏ ุขูพุงุฑุชูุงู
๐ Summary: [ุขูุงุฑ]
๐ง Email report sent
```

### **ูุฑุญูู 3: ฺฉุฑุงููโูุง ุฒูุงูโุจูุฏ ุดุฏู**
```
๐ Scheduled crawl triggered at [ุชุงุฑุฎ ู ุฒูุงู]
๐ Processing: [ุดูุฑ ู ููุน ุขฺฏู]
๐ Summary: [ุขูุงุฑ]
```

## ๐ง **ุณุณุชู ุงูู**

### **ุงููโูุง ุงุฑุณุงู**:

#### **1. ุงูู ฺฏุฒุงุฑุด ุดูุฑ**:
- ุจุนุฏ ุงุฒ ูุฑ ุดูุฑ/ููุน ุขฺฏู
- ุดุงูู: ุขูุงุฑ ฺฉุฑุงููุ ูุฏุช ุฒูุงูุ ุขฺฏูโูุง ุฌุฏุฏ

#### **2. ุงูู ุฎูุงุตู ููุง**:
- ุจุนุฏ ุงุฒ ุงุชูุงู ุชูุงู ฺฉุฑุงููโูุง
- ุดุงูู: ุขูุงุฑ ฺฉูุ ูุถุนุช ููุง

### **ุชูุธูุงุช ุงูู**:
```javascript
email: {
    enabled: true,                    // ูุนุงู/ุบุฑูุนุงู ฺฉุฑุฏู ุงูู
    sendAfterEachCity: true,          // ุงูู ุจุนุฏ ุงุฒ ูุฑ ุดูุฑ
    sendFinalSummary: true,           // ุงูู ุฎูุงุตู ููุง
    includeDatabaseStats: true        // ุดุงูู ุขูุงุฑ ุฏุชุงุจุณ
}
```

## ๐๏ธ **ูุฏุฑุช ุฏุชุงุจุณ**

### **ุฐุฎุฑู ุงุทูุงุนุงุช**:
- โ **ุงุทูุงุนุงุช ูพุงู**: ุนููุงู ู ููฺฉ (ููุฑ)
- โ **ุฌุฒุฆุงุช**: ุบุฑูุนุงู (ูุนูุงู)
- โ **ุจุฑุฑุณ ุชฺฉุฑุงุฑ**: ูุนุงู
- โ **ูพุดุชุจุงู ูุงู**: ูุนุงู

### **ุณุงุฎุชุงุฑ ุฐุฎุฑู**:
```javascript
{
    title: "ุนููุงู ุขฺฏู",
    link: "ููฺฉ ุขฺฏู",
    city: "ุดูุฑ",
    adType: "ููุน ุขฺฏู",
    createdAt: "ุชุงุฑุฎ ุงุฌุงุฏ"
}
```

## ๐๏ธ **ุนุจโุงุจ**

### **ูุดฺฉูุงุช ุฑุงุฌ**:

#### **1. ุฎุทุง Chrome**:
```bash
# ูุตุจ Chrome
sudo apt update
sudo apt install google-chrome-stable

# ุชูุธู ูุณุฑ ุฏุฑ ฺฉุงููฺฏ
executablePath: '/usr/bin/google-chrome'
```

#### **2. ุฎุทุง ุฏุชุงุจุณ**:
```bash
# ุจุฑุฑุณ ุงุชุตุงู
npm run db:migrate

# ุจุฑุฑุณ ูุฏูโูุง
node -e "require('./src/models').sequelize.authenticate().then(() => console.log('OK')).catch(console.error)"
```

#### **3. ุฎุทุง ุงูู**:
```bash
# ุชุณุช ุงูู
node src/test-email.js

# ุจุฑุฑุณ ุชูุธูุงุช SMTP
src/config/email.js
```

### **ูุงฺฏโูุง**:
```bash
# ูุดุงูุฏู ูุงฺฏโูุง ุฒูุฏู
npm run auto-crawler

# ุจุฑุฑุณ ูุงู ูุงฺฏ (ุงฺฏุฑ ูุนุงู ุจุงุดุฏ)
tail -f auto-crawler.log
```

## ๐ **ูุธุงุฑุช ู ุขูุงุฑ**

### **ุขูุงุฑ ูุงุจู ูุดุงูุฏู**:
- ๐ ุชุนุฏุงุฏ ฺฉู ุขฺฏูโูุง
- ๐ ุขฺฏูโูุง ุฌุฏุฏ ูุฑ ุงุฌุฑุง
- โฑ๏ธ ูุฏุช ุฒูุงู ฺฉุฑุงูู
- ๐ ุฒูุงู ุขุฎุฑู ุงุฌุฑุง
- ๐ง ูุถุนุช ุงููโูุง

### **ฺฏุฒุงุฑุดโูุง ุฎูุฏฺฉุงุฑ**:
- ๐ง ุงูู ุจุนุฏ ุงุฒ ูุฑ ุดูุฑ
- ๐ง ุงูู ุฎูุงุตู ููุง
- ๐ ุขูุงุฑ ุฏุชุงุจุณ
- โ๏ธ ฺฏุฒุงุฑุด ุฎุทุงูุง

## ๐ **ุงููุช ู ูพุงุฏุงุฑ**

### **ูฺฺฏโูุง ุงููุช**:
- โ ุชููู ุงูู ุฏุฑ ุตูุฑุช ุฎุทุง
- โ ุชูุงุด ูุฌุฏุฏ ุฎูุฏฺฉุงุฑ
- โ ุจุฑุฑุณ ุณูุงูุช ุณุณุชู
- โ ูุฏุฑุช ุญุงูุธู

### **ุชูุธูุงุช ูพุงุฏุงุฑ**:
```javascript
performance: {
    maxConcurrentCities: 1,    // ูพุฑุฏุงุฒุด ุดูุฑูุง ฺฉ ฺฉ
    retryOnFailure: true,      // ุชูุงุด ูุฌุฏุฏ ุฏุฑ ุตูุฑุช ุดฺฉุณุช
    maxRetries: 3,             // ุญุฏุงฺฉุซุฑ 3 ุชูุงุด
    retryDelay: 30000          // 30 ุซุงูู ุชุงุฎุฑ
}
```

## ๐ **ูุซุงูโูุง ฺฉุงุฑุจุฑุฏ**

### **1. ุชุบุฑ ูุงุตูู ุฒูุงู**:
```javascript
// ุฏุฑ src/config/auto-crawler.js
currentInterval: 'every2Hours' // ูุฑ 2 ุณุงุนุช
```

### **2. ุบุฑูุนุงู ฺฉุฑุฏู ุดูุฑ**:
```javascript
targets: [
    { city: 'tehran', adType: 'buy-apartment', enabled: false },
    // ... ุณุงุฑ ุดูุฑูุง
]
```

### **3. ุชุบุฑ ุชูุธูุงุช ฺฉุฑุงูู**:
```javascript
crawling: {
    timeout: 180000,           // 3 ุฏููู
    scrollDelay: 2000,         // 2 ุซุงูู
    waitBetweenCities: 10000   // 10 ุซุงูู
}
```

## ๐ **ุดุฑูุน ู ุชููู**

### **ุดุฑูุน ุณุฑูุณ**:
```bash
npm run auto-crawler
```

### **ุชููู ุณุฑูุณ**:
```bash
# ุฏุฑ ุชุฑููุงู ุงุฌุฑุง ุดุฏู
Ctrl + C

# ุง ุงุฒ ุทุฑู ฺฉุฏ
process.kill(process.pid, 'SIGINT')
```

### **ุชุณุช ุจุฏูู ุงุฌุฑุง ุฎูุฏฺฉุงุฑ**:
```bash
npm run auto-crawler:test
```

## ๐ **ูุงูโูุง ูุฑุชุจุท**

- **`src/auto-crawler.js`**: ุณุฑูุณ ุงุตู ฺฉุฑุงูู ุฎูุฏฺฉุงุฑ
- **`src/config/auto-crawler.js`**: ุชูุธูุงุช ฺฉุฑุงูู ุฎูุฏฺฉุงุฑ
- **`src/services/databaseService.js`**: ุณุฑูุณ ุฏุชุงุจุณ
- **`src/services/emailService.js`**: ุณุฑูุณ ุงูู
- **`src/services/crawlerService.js`**: ุณุฑูุณ ฺฉุฑุงูู

## โ **ูุชุฌูโฺฏุฑ**

ุณุณุชู ฺฉุฑุงูู ุฎูุฏฺฉุงุฑ ุฏูุงุฑ:
- ๐ค **ุฎูุฏฺฉุงุฑ** ู **ููุดููุฏ** ุงุณุช
- โฐ **ูุฑ ุณุงุนุช** ุงุฌุฑุง ูโุดูุฏ
- ๐ง **ฺฏุฒุงุฑุด ฺฉุงูู** ุงุฑุณุงู ูโฺฉูุฏ
- ๐๏ธ **ุฏุชุงุจุณ** ุฑุง ุจูโุฑูุฒุฑุณุงู ูโฺฉูุฏ
- ๐ **ุงูู** ู **ูพุงุฏุงุฑ** ุงุณุช

## ๐ **ุขูุงุฏู ุงุณุชูุงุฏู!**

```bash
npm run auto-crawler
```

ุณุณุชู ุดุฑูุน ุจู ฺฉุงุฑ ูโฺฉูุฏ ู ูุฑ ุณุงุนุช ุขฺฏูโูุง ุฌุฏุฏ ุฑุง ฺฉุฑุงูู ูโฺฉูุฏ! ๐
